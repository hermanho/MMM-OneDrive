/*! *****************************************************************************
  mmm-onedrive
  Version 1.5.0

  MagicMirrorÂ² module to display your photos from OneDrive.
  Please submit bugs at https://github.com/hermanho/MMM-OneDrive/issues

  (c) hermanho
  Licence: MIT

  This file is auto-generated. Do not edit.
***************************************************************************** */

!function(){"use strict";Module.register("MMM-OneDrive",{defaults:{albums:[],updateInterval:3e4,sort:"new",condition:{fromDate:null,toDate:null,minWidth:null,maxWidth:null,minHeight:null,maxHeight:null,minWHRatio:null,maxWHRatio:null},showWidth:1080,showHeight:1920,timeFormat:"YYYY/MM/DD HH:mm",autoInfoPosition:!1,forceAuthInteractive:!1},requiresVersion:"2.24.0",suspended:!1,getScripts:()=>["moment.js"],getStyles:function(){return["MMM-OneDrive.css"]},start:function(){this.uploadableAlbum=null,this.albums=null,this.scanned=[],this.updateTimer=null,this.index=0,this.needMorePicsFlag=!0,this.firstScan=!0,this.config.updateInterval<1e4&&(this.config.updateInterval=1e4),this.config.condition=Object.assign({},this.defaults.condition,this.config.condition);const e=Object.assign({},this.config);for(let t=0;t<this.config.albums.length;t++){const i=this.config.albums[t];i instanceof RegExp&&(e.albums[t]={source:i.source,flags:i.flags})}this.sendSocketNotification("INIT",e),this.dynamicPosition=0},socketNotificationReceived:function(e,t){if("UPLOADABLE_ALBUM"===e&&(this.uploadableAlbum=t),"INITIALIZED"===e&&(this.albums=t,this.updateTimer&&null!==this.updateTimer||(console.info("[MMM-OneDrive] Start timer for updating photos."),this.updateTimer=setInterval((()=>{this.updatePhotos()}),this.config.updateInterval))),"UPDATE_ALBUMS"===e&&(this.albums=t),"MORE_PICS"===e&&(t&&Array.isArray(t)&&t.length>0&&(this.needMorePicsFlag=!1,this.scanned=t,this.index=0),this.firstScan&&this.updatePhotos()),"ERROR"===e){const e=document.getElementById("ONEDRIVE_PHOTO_CURRENT");e.textContent="";const i=document.createElement("div");Object.assign(i.style,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"});const n=document.createElement("div");Object.assign(n.style,{maxWidth:"70vw",fontSize:"1.5em"}),n.textContent=t,i.appendChild(n),e.appendChild(i)}if("CLEAR_ERROR"===e){document.getElementById("ONEDRIVE_PHOTO_CURRENT").textContent=""}if("UPDATE_STATUS"===e){document.getElementById("ONEDRIVE_PHOTO_INFO").innerHTML=String(t)}if("RENDER_PHOTO"===e){this.state={type:"newPhoto",payload:t};const{photo:e,photoBase64:i}=t,n=`data:${"image/heic"===e.mimeType?"image/jpeg":e.mimeType};base64,${i}`;console.debug("[MMM-OneDrive] render image",{id:e.id}),this.render(n,e)}},notificationReceived:function(e,t,i){"ONEDRIVE_PHOTO_NEXT"===e&&this.updatePhotos()},updatePhotos:function(){if(console.debug("[MMM-OneDrive] Updating photos.."),this.firstScan=!1,0===this.scanned.length)return void this.sendSocketNotification("NEED_MORE_PICS",[]);if(this.suspended){this.sendSocketNotification("MODULE_SUSPENDED_SKIP_UPDATE",void 0);return void(document.getElementById("ONEDRIVE_PHOTO_INFO").innerHTML="")}this.index>=this.scanned.length&&(this.index-=this.scanned.length);const e=this.scanned[this.index];this.sendSocketNotification("TRIGGER_SHOWING_PHOTO",{photoId:e.id}),this.needMorePicsFlag=!1,this.index++,this.index>=this.scanned.length&&(this.index=0,this.needMorePicsFlag=!0,setTimeout((()=>{this.sendSocketNotification("NEED_MORE_PICS",[])}),2e3))},render:function(e,t){console.debug("[MMM-OneDrive] render image",{id:t.id,url:e,mimeType:t.mimeType});const i=new Date,n=document.getElementById("ONEDRIVE_PHOTO_BACKDROP"),o=document.getElementById("ONEDRIVE_PHOTO_CURRENT");o.textContent="",n.style.backgroundImage=`url(${e})`,o.style.backgroundImage=`url(${e})`,o.classList.add("animated");const s=document.getElementById("ONEDRIVE_PHOTO_INFO"),d=this.albums.find((e=>e.id===t._albumId));if(this.config.autoInfoPosition){let e=(e,t)=>{const i=new Date;return[[0,"none","none",0],["none","none",0,0],["none",0,0,"none"],[0,0,"none","none"]][Math.floor(i.getMinutes()/15)]};"function"==typeof this.config.autoInfoPosition&&(e=this.config.autoInfoPosition);const[i,n,o,a]=e(d,t);s.style.setProperty("--top",String(i)),s.style.setProperty("--left",String(n)),s.style.setProperty("--bottom",String(o)),s.style.setProperty("--right",String(a))}s.innerHTML="";const a=document.createElement("div");a.classList.add("albumCover"),a.style.backgroundImage=`url(modules/MMM-OneDrive/cache/${d.id})`;const c=document.createElement("div");c.classList.add("albumTitle"),c.innerHTML=d.title;const l=document.createElement("div");l.classList.add("photoTime"),l.innerHTML="relative"===this.config.timeFormat?moment(t.mediaMetadata.dateTimeOriginal).fromNow():moment(t.mediaMetadata.dateTimeOriginal).format(this.config.timeFormat);const h=document.createElement("div");h.classList.add("infoText"),s.appendChild(a),h.appendChild(c),h.appendChild(l),s.appendChild(h),console.debug("[MMM-OneDrive] render image done",{id:t.id,duration:(new Date).getTime()-i.getTime()}),this.sendSocketNotification("IMAGE_LOADED",{id:t.id,filename:t.filename,indexOfPhotos:t._indexOfPhotos})},getDom:function(){const e=document.createElement("div");e.id="ONEDRIVE_PHOTO";const t=document.createElement("div");t.id="ONEDRIVE_PHOTO_BACKDROP";const i=document.createElement("div");i.id="ONEDRIVE_PHOTO_CURRENT",-1===this.data.position.search("fullscreen")&&(this.config.showWidth&&(e.style.width=this.config.showWidth+"px"),this.config.showHeight&&(e.style.height=this.config.showHeight+"px")),i.addEventListener("animationend",(()=>{i.classList.remove("animated")}));const n=document.createElement("div");return n.id="ONEDRIVE_PHOTO_INFO",n.innerHTML="Loading...",e.appendChild(t),e.appendChild(i),e.appendChild(n),console.info("[MMM-OneDrive] Dom updated!"),e},suspend(){this.suspended=!0},resume(){this.suspended=!1}})}();
//# sourceMappingURL=MMM-OneDrive.js.map
